<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fef5e7">
    <title>ãœã‚ - ç§‘ç›®é¸æŠ</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">

    <!-- Theme Color -->
    <meta name="theme-color" content="#4285f4">

    <!-- Apple Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ãœã‚">

    <link rel="icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Zen+Kurenaido&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theme-toggle.css">
    <script src="../js/theme.js"></script>
</head>

<body>
    <div class="notebook">
        <div class="doodle-bg doodle-star">â˜…</div>
        <div class="doodle-bg doodle-heart">â™¡</div>
        <div class="doodle-bg doodle-note">â™ª</div>
        <div class="doodle-bg doodle-smile">â˜º</div>
        <div class="doodle-bg doodle-check">âœ“</div>
        <div class="doodle-bg doodle-arrow">â†’</div>
        <div class="doodle-bg doodle-circle">â—¯</div>
        <div class="doodle-bg doodle-flower">âœ¿</div>
        <div class="doodle-bg doodle-sun">â˜€</div>
        <div class="doodle-bg doodle-cloud">â˜</div>
        <div class="doodle-bg doodle-pencil">âœ</div>
        <div class="doodle-bg doodle-book">ğŸ“–</div>

        <div class="scribble scribble-1"></div>
        <div class="scribble scribble-2"></div>
        <div class="scribble scribble-3"></div>

        <div class="theme-toggle-container">
            <label class="theme-toggle">
                <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="container">
            <div class="subject-select">
                <h1>å­¦ç¿’ãƒãƒ¼ãƒˆ</h1>
                <p class="subtitle">ç§‘ç›®ã‚’é¸ã‚“ã§ãã ã•ã„</p>

                <div class="user-info">
                    <p class="welcome-text">ã“ã‚“ã«ã¡ã¯ã€<span id="userName">ã‚²ã‚¹ãƒˆ</span>ã•ã‚“</p>
                    <div class="user-actions">
                        <button class="profile-btn" onclick="location.href='profile.html'">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
                        <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                    </div>
                </div>

                <div id="continueSection" class="continue-section hidden">
                    <button class="continue-btn" onclick="continueLastStudy()">
                        <span class="continue-icon">â–¶</span>
                        <div class="continue-text">
                            <div class="continue-title">å‰å›ã®ç¶šãã‹ã‚‰</div>
                            <div class="continue-detail" id="continueDetail">-</div>
                        </div>
                    </button>
                </div>

                <div class="subject-grid">
                    <div class="subject-card" onclick="location.href='english-menu.html'">
                        <div class="subject-icon">A</div>
                        <div class="subject-name">è‹±èª</div>
                    </div>
                    <div class="subject-card" onclick="location.href='category-detail.html?category=math'">
                        <div class="subject-icon">âˆ‘</div>
                        <div class="subject-name">æ•°å­¦</div>
                    </div>
                    <div class="subject-card" onclick="location.href='category-detail.html?category=physics'">
                        <div class="subject-icon">F</div>
                        <div class="subject-name">ç‰©ç†</div>
                    </div>
                    <div class="subject-card" onclick="location.href='category-detail.html?category=chemistry'">
                        <div class="subject-icon">Hâ‚‚O</div>
                        <div class="subject-name">åŒ–å­¦</div>
                    </div>
                    <div class="subject-card" onclick="location.href='eisakujikken.html'">
                        <div class="subject-icon">âœï¸</div>
                        <div class="subject-name">è‹±ä½œæ–‡æ·»å‰Š</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        } else {
            document.getElementById('userName').textContent = currentUser.username;
        }

        // å‰å›ã®å­¦ç¿’æƒ…å ±ã‚’è¡¨ç¤º
        const lastStudyKey = currentUser.isGuest ? 'lastStudy_guest' : `lastStudy_${currentUser.username}`;
        const lastStudy = JSON.parse(localStorage.getItem(lastStudyKey));
        
        if (lastStudy && lastStudy.subject && lastStudy.level) {
            const continueSection = document.getElementById('continueSection');
            const continueDetail = document.getElementById('continueDetail');
            
            // ãƒ¬ãƒ™ãƒ«åã‚’å–å¾—
            const levelNames = {
                'vocab_1': '1ç´š',
                'vocab_pre1': 'æº–1ç´š',
                'vocab_2': '2ç´š',
                'vocab_other': 'åŸºç¤',
                'listen_kyotsu': 'å…±é€šãƒ†ã‚¹ãƒˆ',
                'listen_todai': 'æ±å¤§',
                'listen_other': 'åŸºç¤',
                'grammar_4choice': 'å››æŠå•é¡Œ',
                'grammar_correct': 'èª¤æ–‡è¨‚æ­£',
                'grammar_fill': 'ç©ºæ‰€è£œå……',
                'grammar_arrange': 'æ•´åºå•é¡Œ',
                'read_1b': '1B',
                'read_5': '5',
                'math_1a': '1A',
                'math_2b': '2B',
                'math_3c': '3C',
                'math_random': 'ãƒ©ãƒ³ãƒ€ãƒ æ¼”ç¿’',
                'physics_mechanics': 'åŠ›å­¦',
                'physics_electric': 'é›»ç£æ°—',
                'physics_wave': 'æ³¢å‹•',
                'physics_thermo': 'ç†±',
                'physics_atomic': 'åŸå­',
                'chem_theory': 'ç†è«–',
                'chem_inorganic': 'ç„¡æ©Ÿ',
                'chem_organic': 'æœ‰æ©Ÿ'
            };
            
            const subjectNames = {
                'vocabulary': 'è‹±èª - èªå½™',
                'listening': 'è‹±èª - ãƒªã‚¹ãƒ‹ãƒ³ã‚°',
                'grammar': 'è‹±èª - æ–‡æ³•',
                'reading': 'è‹±èª - èª­è§£',
                'math': 'æ•°å­¦',
                'physics': 'ç‰©ç†',
                'chemistry': 'åŒ–å­¦'
            };
            
            const levelName = levelNames[lastStudy.level] || lastStudy.level;
            const subjectName = subjectNames[lastStudy.subject] || lastStudy.subject;
            
            continueDetail.textContent = `${subjectName} - ${levelName}`;
            continueSection.classList.remove('hidden');
        }

        function continueLastStudy() {
            if (lastStudy && lastStudy.subject && lastStudy.level) {
                window.location.href = `study.html?subject=${lastStudy.subject}&level=${lastStudy.level}`;
            }
        }

        function logout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }
    </script>

<!-- Service Worker disabled to prevent cache conflicts -->
<script>
    console.log("Service Worker and PWA features disabled for stability");
</script>
</body>

</html>
