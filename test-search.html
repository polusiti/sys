<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤œç´¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ - Data Manager</title>
    <link rel="stylesheet" href="assets/css/global.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-section {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .test-button {
            background: var(--color-primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .test-button:hover {
            background: var(--color-primary-dark);
            transform: translateY(-1px);
        }
        
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        
        .test-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .test-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .responsive-test {
            display: grid;
            gap: 1rem;
            grid-template-columns: 1fr;
        }
        
        @media (min-width: 640px) {
            .responsive-test {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (min-width: 1024px) {
            .responsive-test {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
        
        .device-preview {
            border: 2px solid var(--color-border);
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: var(--color-bg-alt);
        }
        
        .device-info {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header style="text-align: center; margin-bottom: 3rem;">
            <h1>ğŸ” æ¤œç´¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
            <p>Data Manager System æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…ãƒ†ã‚¹ãƒˆ</p>
        </header>

        <!-- åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>âš¡ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
            <p>æ¤œç´¢æ©Ÿèƒ½ã®åŸºæœ¬çš„ãªå‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
            
            <button class="test-button" onclick="testSearchRedirect()">
                æ¤œç´¢ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            </button>
            
            <button class="test-button" onclick="testSearchManager()">
                SearchManager ã‚¯ãƒ©ã‚¹
            </button>
            
            <button class="test-button" onclick="testQuestaClient()">
                QuestaD1Client
            </button>
            
            <button class="test-button" onclick="testLocalStorage()">
                ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
            </button>
            
            <div id="basicTestResult" class="test-result" style="display: none;"></div>
        </div>

        <!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <p>ç•°ãªã‚‹ç”»é¢ã‚µã‚¤ã‚ºã§ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
            
            <div class="responsive-test">
                <div class="device-preview">
                    <div class="device-info">ğŸ“± ãƒ¢ãƒã‚¤ãƒ«</div>
                    <div>< 640px</div>
                    <div style="margin-top: 1rem;">
                        <div style="background: var(--color-primary); height: 40px; border-radius: 0.5rem; margin-bottom: 0.5rem;"></div>
                        <div style="background: var(--color-bg); height: 30px; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                        <div style="background: var(--color-bg); height: 30px; border-radius: 0.25rem;"></div>
                    </div>
                </div>
                
                <div class="device-preview">
                    <div class="device-info">ğŸ’» ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ</div>
                    <div>640px - 1024px</div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <div style="flex: 1; background: var(--color-primary); height: 40px; border-radius: 0.5rem;"></div>
                        <div style="flex: 1; background: var(--color-bg); height: 40px; border-radius: 0.25rem;"></div>
                    </div>
                </div>
                
                <div class="device-preview">
                    <div class="device-info">ğŸ–¥ï¸ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—</div>
                    <div>> 1024px</div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.25rem;">
                        <div style="flex: 1; background: var(--color-primary); height: 30px; border-radius: 0.25rem;"></div>
                        <div style="flex: 1; background: var(--color-bg); height: 30px; border-radius: 0.25rem;"></div>
                        <div style="flex: 1; background: var(--color-bg); height: 30px; border-radius: 0.25rem;"></div>
                    </div>
                </div>
            </div>
            
            <button class="test-button" onclick="testResponsiveLayout()">
                ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆ
            </button>
            
            <div id="responsiveTestResult" class="test-result" style="display: none;"></div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
            <p>æ¤œç´¢æ©Ÿèƒ½ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®šã—ã¾ã™ã€‚</p>
            
            <button class="test-button" onclick="testSearchPerformance()">
                æ¤œç´¢é€Ÿåº¦ãƒ†ã‚¹ãƒˆ
            </button>
            
            <button class="test-button" onclick="testLocalStoragePerformance()">
                ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é€Ÿåº¦
            </button>
            
            <div id="performanceTestResult" class="test-result" style="display: none;"></div>
        </div>

        <!-- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>â™¿ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h2>
            <p>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
            
            <button class="test-button" onclick="testKeyboardNavigation()">
                ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            </button>
            
            <button class="test-button" onclick="testFocusManagement()">
                ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†
            </button>
            
            <div id="accessibilityTestResult" class="test-result" style="display: none;"></div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ”— çµ±åˆãƒ†ã‚¹ãƒˆ</h2>
            <p>å…¨ä½“çš„ãªæ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
            
            <button class="test-button" onclick="runAllTests()">
                ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            </button>
            
            <div id="integrationTestResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- æ¤œç´¢æ©Ÿèƒ½ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
    <script src="assets/js/questa-d1-client.js"></script>
    <script src="assets/js/search-manager.js"></script>
    <script src="assets/js/search-integration.js"></script>

    <script>
        // ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤ºã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function showResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `test-result ${success ? 'test-success' : 'test-error'}`;
            element.textContent = message;
        }

        // åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testSearchRedirect() {
            try {
                if (typeof showSearch === 'function') {
                    showResult('basicTestResult', true, 'âœ… showSearché–¢æ•°ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                } else {
                    showResult('basicTestResult', false, 'âŒ showSearché–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                showResult('basicTestResult', false, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function testSearchManager() {
            try {
                const searchManager = new SearchManager();
                if (searchManager && typeof searchManager.init === 'function') {
                    showResult('basicTestResult', true, 'âœ… SearchManagerã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ');
                } else {
                    showResult('basicTestResult', false, 'âŒ SearchManagerã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showResult('basicTestResult', false, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function testQuestaClient() {
            try {
                const client = new QuestaD1Client();
                if (client && typeof client.searchQuestions === 'function') {
                    showResult('basicTestResult', true, 'âœ… QuestaD1ClientãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ');
                } else {
                    showResult('basicTestResult', false, 'âŒ QuestaD1Clientã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showResult('basicTestResult', false, `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function testLocalStorage() {
            try {
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                const testData = { test: 'search_functionality', timestamp: Date.now() };
                localStorage.setItem('searchTest', JSON.stringify(testData));
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const retrieved = localStorage.getItem('searchTest');
                const parsed = JSON.parse(retrieved);
                
                if (parsed.test === 'search_functionality') {
                    localStorage.removeItem('searchTest');
                    showResult('basicTestResult', true, 'âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™');
                } else {
                    showResult('basicTestResult', false, 'âŒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆ');
                }
            } catch (error) {
                showResult('basicTestResult', false, `âŒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
        function testResponsiveLayout() {
            const width = window.innerWidth;
            let deviceType, expected;
            
            if (width < 640) {
                deviceType = 'ãƒ¢ãƒã‚¤ãƒ«';
                expected = 'single-column layout';
            } else if (width < 1024) {
                deviceType = 'ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ';
                expected = 'two-column layout';
            } else {
                deviceType = 'ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—';
                expected = 'multi-column layout';
            }
            
            showResult('responsiveTestResult', true, 
                `âœ… ç¾åœ¨ã®ãƒ‡ãƒã‚¤ã‚¹: ${deviceType} (${width}px)\næœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: ${expected}`);
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        async function testSearchPerformance() {
            try {
                const client = new QuestaD1Client();
                const startTime = performance.now();
                
                // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ã®æ¤œç´¢ãƒ†ã‚¹ãƒˆ
                await client.searchQuestionsFromLocalStorage('test', {}, 'created_desc', 10, 0);
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                if (duration < 100) {
                    showResult('performanceTestResult', true, 
                        `âœ… æ¤œç´¢å‡¦ç†æ™‚é–“: ${duration.toFixed(2)}ms (è‰¯å¥½)`);
                } else {
                    showResult('performanceTestResult', false, 
                        `âš ï¸ æ¤œç´¢å‡¦ç†æ™‚é–“: ${duration.toFixed(2)}ms (æ”¹å–„ã®ä½™åœ°ã‚ã‚Š)`);
                }
            } catch (error) {
                showResult('performanceTestResult', false, 
                    `âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function testLocalStoragePerformance() {
            const startTime = performance.now();
            
            // å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»å–å¾—ãƒ†ã‚¹ãƒˆ
            const largeData = Array.from({length: 1000}, (_, i) => ({
                id: `test_${i}`,
                title: `ãƒ†ã‚¹ãƒˆå•é¡Œ ${i}`,
                content: 'ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚'.repeat(10)
            }));
            
            localStorage.setItem('performanceTest', JSON.stringify(largeData));
            const retrieved = JSON.parse(localStorage.getItem('performanceTest'));
            localStorage.removeItem('performanceTest');
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            if (duration < 50 && retrieved.length === 1000) {
                showResult('performanceTestResult', true, 
                    `âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å‡¦ç†æ™‚é–“: ${duration.toFixed(2)}ms`);
            } else {
                showResult('performanceTestResult', false, 
                    `âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å‡¦ç†æ™‚é–“: ${duration.toFixed(2)}ms`);
            }
        }

        // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
        function testKeyboardNavigation() {
            const interactiveElements = document.querySelectorAll(
                'button, input, select, textarea, a[href], [tabindex]:not([tabindex="-1"])'
            );
            
            let accessibleCount = 0;
            interactiveElements.forEach(element => {
                if (element.offsetParent !== null) { // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹è¦ç´ ã®ã¿
                    accessibleCount++;
                }
            });
            
            showResult('accessibilityTestResult', true, 
                `âœ… ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªè¦ç´ : ${accessibleCount}å€‹`);
        }

        function testFocusManagement() {
            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½ãªè¦ç´ ã®ãƒ†ã‚¹ãƒˆ
            const firstButton = document.querySelector('.test-button');
            if (firstButton) {
                firstButton.focus();
                
                if (document.activeElement === firstButton) {
                    showResult('accessibilityTestResult', true, 
                        'âœ… ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™');
                } else {
                    showResult('accessibilityTestResult', false, 
                        'âŒ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ã«å•é¡ŒãŒã‚ã‚Šã¾ã™');
                }
            }
        }

        // çµ±åˆãƒ†ã‚¹ãƒˆ
        async function runAllTests() {
            showResult('integrationTestResult', true, 'ğŸ”„ å…¨ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...');
            
            let passedTests = 0;
            let totalTests = 0;
            
            // å„ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            const tests = [
                () => typeof showSearch === 'function',
                () => typeof SearchManager !== 'undefined',
                () => typeof QuestaD1Client !== 'undefined',
                () => localStorage !== undefined,
                () => window.innerWidth > 0
            ];
            
            for (const test of tests) {
                totalTests++;
                try {
                    if (test()) {
                        passedTests++;
                    }
                } catch (error) {
                    console.error('Test failed:', error);
                }
            }
            
            const successRate = (passedTests / totalTests) * 100;
            
            setTimeout(() => {
                if (successRate >= 80) {
                    showResult('integrationTestResult', true, 
                        `âœ… çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†: ${passedTests}/${totalTests} ãƒ‘ã‚¹ (${successRate.toFixed(1)}%)`);
                } else {
                    showResult('integrationTestResult', false, 
                        `âš ï¸ çµ±åˆãƒ†ã‚¹ãƒˆ: ${passedTests}/${totalTests} ãƒ‘ã‚¹ (${successRate.toFixed(1)}%) - æ”¹å–„ãŒå¿…è¦`);
                }
            }, 1000);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ” æ¤œç´¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            // runAllTests();
        });
    </script>
</body>
</html>