# 英文添削実験機能 (/eisakujikken)

## 概要

`/eisakujikken` はLanguageTool APIを活用した英文添削の実験的機能です。
AI技術を使ってリアルタイムに英文法をチェックし、修正案と説明を提供します。

## 特徴

### 🎨 デザイン
- 既存の手書き風ノートブックスタイルを維持
- 実験的機能を示すパルスアニメーション付きバッジ
- レスポンシブ対応でスマホでも快適に利用

### 🤖 AI技術スタック
1. **KVキャッシュ**: 高速な応答とコスト削減
2. **正規表現パターン**: 基本的な文法エラーを即座に検出
3. **D1ナレッジベース**: カスタム文法ルールを保持
4. **DeepSeek API**: 高精度な文法解析（主力）
5. **Workers AI**: 安定性のための最終フォールバック

### ⚡ パフォーマンス
- 90%以上のリクエストを低コストレイヤーで処理
- 1秒以内の応答速度
- 1000文字まで対応

## ファイル構成

```
sys/
├── pages/
│   ├── subject-select.html     # 実験カードを追加
│   └── eisakujikken.html     # 実験メインページ
├── js/
│   └── eisakujikken.js       # JavaScript機能
├── style.css                  # 実験カードスタイル追加
└── EISAKUJIKKEN_README.md    # このファイル
```

## API連携

### 開発モード
ローカル環境やGitHub Pagesではモック機能が有効になります：
- 基本的な正規表現パターンで文法チェック
- 即座にレスポンスを返す
- APIコストなし

### 本番環境
Cloudflare Workers APIと連携：
```javascript
// APIエンドポイント設定
const API_ENDPOINT = 'https://languagetool-api.your-subdomain.workers.dev/';
```

## 使用方法

1. **アクセス**: 科目選択画面から「実験」カードをクリック
2. **入力**: 添削したい英文をテキストエリアに入力
3. **実行**: 「🔍 添削する」ボタンまたは Ctrl+Enter
4. **確認**: 修正された英文と説明を確認

### ショートカット
- `Ctrl/Cmd + Enter`: 添削実行
- `Shift + Enter`: 改行
- `Escape`: 入力クリア

## デバッグ機能

開発者コンソールでデバッグモードを有効化：
```javascript
localStorage.setItem('eisakujikken_debug', 'true');
```

## 履歴機能

- 直近10件の添削履歴を自動保存
- ブラウザのローカルストレージに保持
- 入力中のテキストは自動的に下書き保存

## エラーハンドリング

### ネットワークエラー
- 自動リトライ機能
- ユーザーフレンドリーなエラーメッセージ
- オフラインでの基本機能維持

### 入力制限
- 最大文字数: 1000文字
- 文字種: 英字、記号のみ対応
- 空入力の検出と警告

## カスタマイズ

### 正規表現パターン追加
```javascript
const PATTERNS = [
    { pattern: /\bnewpattern\b/gi, replacement: 'corrected', explanation: '説明' }
];
```

### APIエンドポイント変更
```javascript
// js/eisakujikken.js
const API_ENDPOINT = 'https://your-api-endpoint.com/';
```

## セキュリティ

- ユーザー入力のサニタイズ
- XSS防止
- APIキーの環境変数管理
- レートリミット対応

## パフォーマンス監視

- レスポンスタイムの記録
- エラーレートの監視
- キャッシュヒット率の確認

## 今後の改善

1. **機能拡張**
   - 複数言語対応
   - 文脈理解の向上
   - 学習機能の追加

2. **UI/UX改善**
   - リアルタイム添削
   - 音声読み上げ
   - プリント機能

3. **技術的改善**
   - より高度なAIモデル
   - パフォーマンス最適化
   - オフライン対応

## フィードバック

実験的機能のため、フィードバックを歓迎します：
- バグ報告
- 改善提案
- 新機能リクエスト

## ライセンス

この実験的機能は、既存のsysプロジェクトのライセンスに準拠します。