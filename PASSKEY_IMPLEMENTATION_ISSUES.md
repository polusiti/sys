# 🔐 パスキー統合登録システムの問題点

## 📋 実装概要

### ✅ 完了した実装

#### 1. **統合パスキー登録フロー**
- **場所**: `js/login.js:35-70`
- **機能**: ユーザー登録とパスキー設定を統合
- **email自動生成**: `${userId}@secure.learning-notebook.local`

#### 2. **UI改善**
- **場所**: `pages/login.html`
- **変更**: email入力欄の削除（将来的に削除予定）
- **UX**: 3項目入力（ID、表示名、秘密質問）のみ

#### 3. **プライバシー保護**
- emailを自動生成し、ユーザー入力を不要化
- 個人情報の最小化

## 🚨 技術的問題点

### 1. **DB制約エラー（最重要）**
```bash
# 現象
D1_ERROR: NOT NULL constraint failed: users.email: SQLITE_CONSTRAINT

# 原因
- SQLテーブル: users.email TEXT NOT NULL
- 実装: emailフィールドを送信しているが制約違反応
```

#### **調査結果**:
- **試したフィールド名**: `email`, `userEmail`, `email_address`, `user_email`
- **結果**: すべて同じエラー
- **推測**: Workers側の実装がemailフィールドを処理していない

### 2. **Workers実装のブラックボックス化**
- **問題**: Workersソースコードがリポジトリに存在しない
- **影響**: デバッグ不能、修正不能

### 3. **APIトークン認証の問題**
- **固定トークン**: `questa-admin-2024` がクライアントにハードコード
- **セキュリティリスク**: トークンが簡単に取得可能

## 🔧 解決に必要な情報

1. **Workersソースコードの所在**
2. **正確なAPI仕様**
3. **DBスキーマの確認**

## 📊 実装状況

| 項目 | 状態 | 完了度 |
|------|------|--------|
| フロントエンド実装 | ✅ 完了 | 95% |
| API連携 | ❌ 問題あり | 60% |
| DB整合性 | ❌ 未解決 | 0% |

---

**作成日**: 2025-10-30