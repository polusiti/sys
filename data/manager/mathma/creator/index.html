<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ å•é¡Œä½œæˆ - å”åƒä½œæˆã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        :root {
            --primary-color: #10b981;
            --secondary-color: #059669;
            --accent-color: #34d399;
            --bg-color: #f0fdf4;
            --text-color: #1f2937;
            --border-color: #bbf7d0;
            --hover-bg: #d1fae5;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --success-color: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid var(--primary-color);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .nav-breadcrumb {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .nav-breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            margin-right: 10px;
        }

        .nav-breadcrumb a:hover {
            text-decoration: underline;
        }

        .form-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .form-section h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .required {
            color: var(--error-color);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .choices-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            display: none;
        }

        .choices-section.show {
            display: block;
        }

        .choice-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .choice-item input[type="text"] {
            flex: 1;
        }

        .choice-item input[type="radio"] {
            margin-right: 5px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .validation-message {
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .validation-message.error {
            color: var(--error-color);
        }

        .validation-message.success {
            color: var(--success-color);
        }

        .preview-section {
            background: #f8fafc;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }

        .preview-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }

        .preview-content.show {
            display: block;
        }

        .preview-question {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .preview-choices {
            margin: 15px 0;
        }

        .preview-choice {
            padding: 10px;
            margin: 5px 0;
            background: #f8fafc;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .preview-choice:hover {
            background: var(--hover-bg);
        }

        .preview-choice.correct {
            background: #d1fae5;
            border-left: 3px solid var(--primary-color);
        }

        .approval-info {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .approval-info h4 {
            margin-bottom: 10px;
        }

        .approval-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .approval-step {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .approval-step-number {
            background: white;
            color: var(--primary-color);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .approval-steps {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-breadcrumb">
            <a href="../">ğŸ”¢ Math Manager</a> â†’ <span>âœ¨ å•é¡Œä½œæˆ</span>
        </div>

        <div class="header">
            <h1>âœ¨ å•é¡Œä½œæˆ</h1>
            <p>å”åƒå•é¡Œä½œæˆã‚·ã‚¹ãƒ†ãƒ  - ç°¡æ½”ã§åŠ¹ç‡çš„</p>
        </div>

        <div class="approval-info">
            <h4>ğŸ“‹ å”åƒä½œæˆãƒ»æ‰¿èªã‚·ã‚¹ãƒ†ãƒ </h4>
            <p>ä½œæˆã•ã‚ŒãŸå•é¡Œã¯3äººä»¥ä¸Šã®æ‰¿èªã‚’çµŒã¦å…¬é–‹ã•ã‚Œã¾ã™ã€‚é«˜å“è³ªãªå•é¡Œä½œæˆã«ã”å”åŠ›ãã ã•ã„ã€‚</p>
            <div class="approval-steps">
                <div class="approval-step">
                    <div class="approval-step-number">1</div>
                    <p>å•é¡Œä½œæˆ</p>
                </div>
                <div class="approval-step">
                    <div class="approval-step-number">2</div>
                    <p>å†…å®¹ç¢ºèª</p>
                </div>
                <div class="approval-step">
                    <div class="approval-step-number">3</div>
                    <p>æ‰¿èªå¾…ã¡</p>
                </div>
                <div class="approval-step">
                    <div class="approval-step-number">4</div>
                    <p>å…¬é–‹</p>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>ğŸ“ åŸºæœ¬æƒ…å ±</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="questionType">å•é¡Œå½¢å¼ <span class="required">*</span></label>
                    <select id="questionType" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="A1">A1æŠ (4-5æŠé¸æŠå•é¡Œ)</option>
                        <option value="F1">F1è‡ªç”± (çŸ­ç­”ãƒ»æ•°å€¤å…¥åŠ›)</option>
                        <option value="F2">F2è¨˜è¿° (å®Œå…¨è¨˜è¿°ãƒ»è¨¼æ˜)</option>
                    </select>
                    <div class="validation-message" id="typeValidation"></div>
                </div>
                <div class="form-group">
                    <label for="difficulty">é›£æ˜“åº¦ <span class="required">*</span></label>
                    <select id="difficulty" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="æ˜“">æ˜“ (åŸºç¤ãƒ¬ãƒ™ãƒ«)</option>
                        <option value="ä¸­">ä¸­ (æ¨™æº–ãƒ¬ãƒ™ãƒ«)</option>
                        <option value="é›£">é›£ (ç™ºå±•ãƒ¬ãƒ™ãƒ«)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="category">ã‚«ãƒ†ã‚´ãƒª <span class="required">*</span></label>
                    <select id="category" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ä»£æ•°">ä»£æ•° (æ–¹ç¨‹å¼ãƒ»ä¸ç­‰å¼)</option>
                        <option value="é–¢æ•°">é–¢æ•° (2æ¬¡é–¢æ•°ãƒ»æŒ‡æ•°å¯¾æ•°)</option>
                        <option value="å›³å½¢">å›³å½¢ (ä¸‰è§’æ¯”ãƒ»åº§æ¨™)</option>
                        <option value="å¾®åˆ†">å¾®åˆ† (å°é–¢æ•°ãƒ»æ¥µé™)</option>
                        <option value="ç©åˆ†">ç©åˆ† (å®šç©åˆ†ãƒ»å¿œç”¨)</option>
                        <option value="ç¢ºç‡">ç¢ºç‡ (å ´åˆã®æ•°ãƒ»çµ±è¨ˆ)</option>
                        <option value="æ•°åˆ—">æ•°åˆ— (ç­‰å·®ãƒ»ç­‰æ¯”ãƒ»æ¼¸åŒ–å¼)</option>
                        <option value="ãƒ™ã‚¯ãƒˆãƒ«">ãƒ™ã‚¯ãƒˆãƒ« (å¹³é¢ãƒ»ç©ºé–“)</option>
                        <option value="ä¸‰è§’é–¢æ•°">ä¸‰è§’é–¢æ•° (åŠ æ³•å®šç†ãƒ»ã‚°ãƒ©ãƒ•)</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="customCategory">ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒª</label>
                    <input type="text" id="customCategory" placeholder="ã€Œãã®ä»–ã€é¸æŠæ™‚ã«å…¥åŠ›">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>ğŸ“‹ å•é¡Œå†…å®¹</h3>
            <div class="form-group">
                <label for="title">å•é¡Œã‚¿ã‚¤ãƒˆãƒ« <span class="required">*</span></label>
                <input type="text" id="title" placeholder="ä¾‹: äºŒæ¬¡æ–¹ç¨‹å¼ã®è§£" required>
                <div class="validation-message" id="titleValidation"></div>
            </div>
            <div class="form-group">
                <label for="question">å•é¡Œæ–‡ <span class="required">*</span></label>
                <textarea id="question" placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚æ•°å¼ã‚‚è¨˜è¿°å¯èƒ½ã§ã™ã€‚" rows="4" required></textarea>
                <div class="validation-message" id="questionValidation"></div>
            </div>
            
            <!-- A1æŠé¸æŠè‚¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="choices-section" id="choicesSection">
                <h4>é¸æŠè‚¢è¨­å®š</h4>
                <div id="choicesList">
                    <div class="choice-item">
                        <input type="radio" name="correctChoice" value="0">
                        <span>1.</span>
                        <input type="text" class="choice-text" placeholder="é¸æŠè‚¢1">
                    </div>
                    <div class="choice-item">
                        <input type="radio" name="correctChoice" value="1">
                        <span>2.</span>
                        <input type="text" class="choice-text" placeholder="é¸æŠè‚¢2">
                    </div>
                    <div class="choice-item">
                        <input type="radio" name="correctChoice" value="2">
                        <span>3.</span>
                        <input type="text" class="choice-text" placeholder="é¸æŠè‚¢3">
                    </div>
                    <div class="choice-item">
                        <input type="radio" name="correctChoice" value="3">
                        <span>4.</span>
                        <input type="text" class="choice-text" placeholder="é¸æŠè‚¢4">
                    </div>
                </div>
                <button type="button" class="btn btn-secondary btn-small" onclick="addChoice()">+ é¸æŠè‚¢è¿½åŠ </button>
                <div class="validation-message" id="choicesValidation"></div>
            </div>

            <!-- F1/F2è§£ç­”ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-group" id="answerSection" style="display: none;">
                <label for="answer">è§£ç­” <span class="required">*</span></label>
                <textarea id="answer" placeholder="F1: æ•°å€¤ã‚„ç°¡æ½”ãªç­”ãˆ&#10;F2: è©³ç´°ãªè¨¼æ˜ã‚„è§£ç­”éç¨‹" rows="3"></textarea>
                <div class="validation-message" id="answerValidation"></div>
            </div>

            <div class="form-group">
                <label for="explanation">è§£èª¬</label>
                <textarea id="explanation" placeholder="è§£ç­”ã®è§£èª¬ã‚„è€ƒãˆæ–¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„" rows="3"></textarea>
            </div>
        </div>

        <div class="form-section">
            <h3>ğŸ” ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
            <div class="preview-section">
                <div id="previewPlaceholder">
                    <p style="color: #6b7280;">å•é¡Œå†…å®¹ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã“ã“ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    <button class="btn btn-secondary btn-small" onclick="updatePreview()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°</button>
                </div>
                <div class="preview-content" id="previewContent">
                    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>ğŸ’¾ ä¿å­˜ãƒ»é€ä¿¡</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-secondary" onclick="saveDraft()">ğŸ“ ä¸‹æ›¸ãä¿å­˜</button>
                <button class="btn btn-warning" onclick="validateAndPreview()">ğŸ” æœ€çµ‚ç¢ºèª</button>
                <button class="btn btn-primary" onclick="submitQuestion()">ğŸ“¤ æ‰¿èªç”³è«‹</button>
                <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </div>

    <script>
        // å•é¡Œä½œæˆã‚·ã‚¹ãƒ†ãƒ 
        class QuestionCreator {
            constructor() {
                this.currentQuestion = {};
                this.choiceCount = 4;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadDraft();
            }

            setupEventListeners() {
                // å•é¡Œå½¢å¼å¤‰æ›´æ™‚ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                document.getElementById('questionType').addEventListener('change', (e) => {
                    this.toggleSections(e.target.value);
                });

                // ã‚«ãƒ†ã‚´ãƒªå¤‰æ›´æ™‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º
                document.getElementById('category').addEventListener('change', (e) => {
                    const customCategory = document.getElementById('customCategory');
                    customCategory.style.display = e.target.value === 'ãã®ä»–' ? 'block' : 'none';
                });

                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                ['title', 'question', 'answer'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', () => this.validateField(id));
                    }
                });

                // è‡ªå‹•ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                ['title', 'question', 'answer'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', () => {
                            clearTimeout(this.previewTimeout);
                            this.previewTimeout = setTimeout(() => this.updatePreview(), 1000);
                        });
                    }
                });
            }

            toggleSections(type) {
                const choicesSection = document.getElementById('choicesSection');
                const answerSection = document.getElementById('answerSection');

                if (type === 'A1') {
                    choicesSection.classList.add('show');
                    answerSection.style.display = 'none';
                } else if (type === 'F1' || type === 'F2') {
                    choicesSection.classList.remove('show');
                    answerSection.style.display = 'block';
                } else {
                    choicesSection.classList.remove('show');
                    answerSection.style.display = 'none';
                }

                this.updatePreview();
            }

            addChoice() {
                if (this.choiceCount >= 6) {
                    alert('é¸æŠè‚¢ã¯æœ€å¤§6å€‹ã¾ã§è¿½åŠ å¯èƒ½ã§ã™ã€‚');
                    return;
                }

                this.choiceCount++;
                const choicesList = document.getElementById('choicesList');
                const newChoice = document.createElement('div');
                newChoice.className = 'choice-item';
                newChoice.innerHTML = `
                    <input type="radio" name="correctChoice" value="${this.choiceCount - 1}">
                    <span>${this.choiceCount}.</span>
                    <input type="text" class="choice-text" placeholder="é¸æŠè‚¢${this.choiceCount}">
                    <button type="button" class="btn btn-secondary btn-small" onclick="this.parentElement.remove()">å‰Šé™¤</button>
                `;
                choicesList.appendChild(newChoice);
            }

            validateField(fieldId) {
                const field = document.getElementById(fieldId);
                const validation = document.getElementById(fieldId + 'Validation');
                
                if (!validation) return;

                if (field.value.trim() === '') {
                    validation.textContent = 'å¿…é ˆé …ç›®ã§ã™';
                    validation.className = 'validation-message error';
                    return false;
                } else {
                    validation.textContent = 'âœ“';
                    validation.className = 'validation-message success';
                    return true;
                }
            }

            validateForm() {
                let isValid = true;
                const requiredFields = ['questionType', 'difficulty', 'category', 'title', 'question'];

                requiredFields.forEach(fieldId => {
                    if (!this.validateField(fieldId)) {
                        isValid = false;
                    }
                });

                // å•é¡Œå½¢å¼åˆ¥ã®è¿½åŠ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                const questionType = document.getElementById('questionType').value;
                if (questionType === 'A1') {
                    const choices = Array.from(document.querySelectorAll('.choice-text')).map(input => input.value.trim());
                    const correctChoice = document.querySelector('input[name="correctChoice"]:checked');
                    
                    if (choices.filter(choice => choice !== '').length < 2) {
                        document.getElementById('choicesValidation').textContent = 'é¸æŠè‚¢ã‚’æœ€ä½2ã¤å…¥åŠ›ã—ã¦ãã ã•ã„';
                        document.getElementById('choicesValidation').className = 'validation-message error';
                        isValid = false;
                    } else if (!correctChoice) {
                        document.getElementById('choicesValidation').textContent = 'æ­£è§£ã‚’é¸æŠã—ã¦ãã ã•ã„';
                        document.getElementById('choicesValidation').className = 'validation-message error';
                        isValid = false;
                    } else {
                        document.getElementById('choicesValidation').textContent = 'âœ“';
                        document.getElementById('choicesValidation').className = 'validation-message success';
                    }
                } else if (questionType === 'F1' || questionType === 'F2') {
                    if (!this.validateField('answer')) {
                        isValid = false;
                    }
                }

                return isValid;
            }

            updatePreview() {
                const previewPlaceholder = document.getElementById('previewPlaceholder');
                const previewContent = document.getElementById('previewContent');
                
                const title = document.getElementById('title').value.trim();
                const question = document.getElementById('question').value.trim();
                const questionType = document.getElementById('questionType').value;

                if (!title || !question || !questionType) {
                    previewPlaceholder.style.display = 'block';
                    previewContent.classList.remove('show');
                    return;
                }

                previewPlaceholder.style.display = 'none';
                previewContent.classList.add('show');

                let previewHTML = `
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">${title}</h4>
                    <div class="preview-question">${question}</div>
                `;

                if (questionType === 'A1') {
                    const choices = Array.from(document.querySelectorAll('.choice-text')).map((input, index) => ({
                        text: input.value.trim(),
                        index: index
                    })).filter(choice => choice.text !== '');

                    const correctChoice = document.querySelector('input[name="correctChoice"]:checked');
                    const correctIndex = correctChoice ? parseInt(correctChoice.value) : -1;

                    if (choices.length > 0) {
                        previewHTML += '<div class="preview-choices">';
                        choices.forEach((choice, index) => {
                            const isCorrect = choice.index === correctIndex;
                            previewHTML += `
                                <div class="preview-choice ${isCorrect ? 'correct' : ''}">
                                    ${index + 1}. ${choice.text}
                                    ${isCorrect ? ' âœ“' : ''}
                                </div>
                            `;
                        });
                        previewHTML += '</div>';
                    }
                } else if (questionType === 'F1' || questionType === 'F2') {
                    const answer = document.getElementById('answer').value.trim();
                    if (answer) {
                        previewHTML += `
                            <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <strong>è§£ç­”:</strong> ${answer}
                            </div>
                        `;
                    }
                }

                const explanation = document.getElementById('explanation').value.trim();
                if (explanation) {
                    previewHTML += `
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <strong>è§£èª¬:</strong> ${explanation}
                        </div>
                    `;
                }

                previewContent.innerHTML = previewHTML;
            }

            generateQuestionId() {
                const timestamp = Date.now().toString(36);
                const random = Math.random().toString(36).substr(2, 5);
                return `math_${timestamp}_${random}`;
            }

            buildQuestionData() {
                const questionType = document.getElementById('questionType').value;
                const data = {
                    id: this.generateQuestionId(),
                    type: questionType,
                    title: document.getElementById('title').value.trim(),
                    question: document.getElementById('question').value.trim(),
                    difficulty: document.getElementById('difficulty').value,
                    category: document.getElementById('category').value === 'ãã®ä»–' ? 
                             document.getElementById('customCategory').value.trim() : 
                             document.getElementById('category').value,
                    explanation: document.getElementById('explanation').value.trim(),
                    created: new Date().toISOString(),
                    approvals: 0,
                    rating: 0,
                    status: 'draft'
                };

                if (questionType === 'A1') {
                    const choices = Array.from(document.querySelectorAll('.choice-text'))
                                         .map(input => input.value.trim())
                                         .filter(choice => choice !== '');
                    const correctChoice = document.querySelector('input[name="correctChoice"]:checked');
                    
                    data.choices = choices;
                    data.correct = correctChoice ? parseInt(correctChoice.value) : 0;
                } else if (questionType === 'F1' || questionType === 'F2') {
                    data.answer = document.getElementById('answer').value.trim();
                }

                return data;
            }

            saveDraft() {
                if (!document.getElementById('title').value.trim()) {
                    alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const questionData = this.buildQuestionData();
                questionData.status = 'draft';
                
                localStorage.setItem('questionDraft', JSON.stringify(questionData));
                alert('ğŸ“ ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            }

            loadDraft() {
                const draft = localStorage.getItem('questionDraft');
                if (!draft) return;

                const data = JSON.parse(draft);
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                });

                // å•é¡Œå½¢å¼ã«å¿œã˜ãŸè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                this.toggleSections(data.type);
                
                // A1æŠã®å ´åˆã€é¸æŠè‚¢ã‚’å¾©å…ƒ
                if (data.type === 'A1' && data.choices) {
                    const choiceInputs = document.querySelectorAll('.choice-text');
                    data.choices.forEach((choice, index) => {
                        if (choiceInputs[index]) {
                            choiceInputs[index].value = choice;
                        }
                    });
                    
                    if (data.correct !== undefined) {
                        const correctRadio = document.querySelector(`input[name="correctChoice"][value="${data.correct}"]`);
                        if (correctRadio) correctRadio.checked = true;
                    }
                }

                this.updatePreview();
            }

            validateAndPreview() {
                if (!this.validateForm()) {
                    alert('âŒ å…¥åŠ›å†…å®¹ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™ã€‚èµ¤è‰²ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                this.updatePreview();
                
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                document.querySelector('.preview-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });

                alert('âœ… å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å•é¡Œãªã‘ã‚Œã°ã€Œæ‰¿èªç”³è«‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
            }

            submitQuestion() {
                if (!this.validateForm()) {
                    alert('âŒ å…¥åŠ›å†…å®¹ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™ã€‚ã€Œæœ€çµ‚ç¢ºèªã€ã§å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const questionData = this.buildQuestionData();
                questionData.status = 'pending';

                // æ—¢å­˜ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const existingQuestions = JSON.parse(localStorage.getItem('mathQuestions') || '[]');
                existingQuestions.push(questionData);
                
                // ä¿å­˜
                localStorage.setItem('mathQuestions', JSON.stringify(existingQuestions));
                
                // ä¸‹æ›¸ãã‚’å‰Šé™¤
                localStorage.removeItem('questionDraft');

                alert('âœ… å•é¡Œã‚’æ‰¿èªç”³è«‹ã—ã¾ã—ãŸï¼æ‰¿èªã•ã‚Œã‚‹ã¨å•é¡Œä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚');
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                this.resetForm();
            }

            resetForm() {
                if (confirm('å…¥åŠ›å†…å®¹ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    document.querySelectorAll('input, select, textarea').forEach(element => {
                        if (element.type === 'radio' || element.type === 'checkbox') {
                            element.checked = false;
                        } else {
                            element.value = '';
                        }
                    });
                    
                    this.toggleSections('');
                    this.updatePreview();
                    
                    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                    document.querySelectorAll('.validation-message').forEach(msg => {
                        msg.textContent = '';
                        msg.className = 'validation-message';
                    });
                }
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        function addChoice() {
            window.questionCreator.addChoice();
        }

        function updatePreview() {
            window.questionCreator.updatePreview();
        }

        function saveDraft() {
            window.questionCreator.saveDraft();
        }

        function validateAndPreview() {
            window.questionCreator.validateAndPreview();
        }

        function submitQuestion() {
            window.questionCreator.submitQuestion();
        }

        function resetForm() {
            window.questionCreator.resetForm();
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.questionCreator = new QuestionCreator();
        });
    </script>
</body>
</html>