<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📚 学習ノート - ホーム</title>

    <!-- Favicon -->
    <link rel="icon" href="https://pub-8aefaeaf72ff490ba094da8a873c6686.r2.dev/notebook-icon.png" type="image/png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">

    <!-- Theme Color -->
    <meta name="theme-color" content="#e74c3c">

    <!-- Apple Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="学習ノート">

    <!-- Microsoft PWA -->
    <meta name="msapplication-TileColor" content="#e74c3c">
    <meta name="msapplication-config" content="/browserconfig.xml">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Zen+Kurenaido&display=swap" rel="stylesheet">

    <style>
        /* Learning Notebook Design System */
        :root {
            --bg-start: #fef5e7;
            --bg-end: #fdebd0;
            --card-bg: #fffef9;
            --card-border: #d4a574;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --primary-color: #e74c3c;
            --primary-hover: #c0392b;
            --accent-blue: #3498db;
            --accent-green: #27ae60;
            --accent-purple: #9b59b6;
            --accent-orange: #e67e22;
            --shadow: rgba(0, 0, 0, 0.1);
            --notebook-line-color: rgba(212, 165, 116, 0.3);
        }

        [data-theme="dark"] {
            --bg-start: #2a2a3a;
            --bg-end: #35354a;
            --card-bg: #38384d;
            --card-border: #575775;
            --text-color: #c8c8d8;
            --text-light: #8888a0;
            --primary-color: #d89090;
            --primary-hover: #b87070;
            --accent-blue: #6ba8d8;
            --accent-green: #5db880;
            --accent-purple: #b88bd8;
            --accent-orange: #d89060;
            --shadow: rgba(0, 0, 0, 0.3);
            --notebook-line-color: rgba(87, 87, 117, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Klee One', 'Hiragino Kaku Gothic ProN', sans-serif;
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--text-color);
            line-height: 1.8;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            /* Notebook ruled lines */
            background-image:
                repeating-linear-gradient(
                    to bottom,
                    transparent 0px,
                    transparent 31px,
                    var(--notebook-line-color) 31px,
                    var(--notebook-line-color) 32px
                );
            background-size: 100% 32px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 3px 3px 0px var(--shadow);
            text-align: center;
            transform: rotate(-0.2deg);
        }

        h1 {
            font-family: 'Zen Kurenaido', cursive;
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 8px;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.05);
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* User Info */
        .user-info {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 25px;
            box-shadow: 3px 3px 0px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transform: rotate(0.1deg);
        }

        .welcome-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: 2px solid var(--card-border);
            border-radius: 20px;
            background: var(--card-bg);
            color: var(--text-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 2px 2px 0px var(--shadow);
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 3px 3px 0px var(--shadow);
            background: var(--bg-start);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 1px 1px 0px var(--shadow);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-hover);
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        /* Continue Learning Section */
        .continue-section {
            background: var(--card-bg);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 3px 3px 0px var(--shadow);
            transform: rotate(-0.1deg);
            display: none;
        }

        .continue-section.show {
            display: block;
        }

        .continue-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--accent-blue);
        }

        /* Subject Grid */
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .subject-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 3px 3px 0px var(--shadow);
            text-decoration: none;
            color: var(--text-color);
            display: block;
        }

        .subject-card:nth-child(1) { transform: rotate(-0.5deg); }
        .subject-card:nth-child(2) { transform: rotate(0.3deg); }
        .subject-card:nth-child(3) { transform: rotate(-0.2deg); }
        .subject-card:nth-child(4) { transform: rotate(0.4deg); }

        .subject-card:hover {
            transform: translateY(-5px) rotate(0deg) !important;
            box-shadow: 5px 5px 0px var(--shadow);
        }

        .subject-card:active {
            transform: translateY(-2px) rotate(0deg) !important;
            box-shadow: 2px 2px 0px var(--shadow);
        }

        .subject-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            display: block;
        }

        .subject-card.english .subject-icon { color: var(--primary-color); }
        .subject-card.math .subject-icon { color: var(--accent-blue); }
        .subject-card.physics .subject-icon { color: var(--accent-green); }
        .subject-card.chemistry .subject-icon { color: var(--accent-purple); }

        .subject-name {
            font-family: 'Zen Kurenaido', cursive;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .subject-desc {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            box-shadow: 3px 3px 0px var(--shadow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.2s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: translateY(-3px) rotate(15deg);
            box-shadow: 4px 4px 0px var(--shadow);
        }

        /* Decorative Doodles */
        .doodle {
            position: fixed;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
            font-size: 2rem;
        }

        .doodle.star1 { top: 10%; left: 5%; animation: float 6s ease-in-out infinite; }
        .doodle.star2 { top: 20%; right: 8%; animation: float 7s ease-in-out infinite 1s; }
        .doodle.heart { top: 70%; left: 10%; animation: float 8s ease-in-out infinite 2s; }
        .doodle.check { bottom: 15%; right: 15%; animation: spin 20s linear infinite; }
        .doodle.flower { top: 50%; right: 5%; animation: float 9s ease-in-out infinite 1.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .subjects-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .user-info {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .user-actions {
                width: 100%;
                justify-content: center;
            }

            .subject-icon {
                font-size: 3rem;
            }

            .subject-name {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 20px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .subject-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Decorative Doodles -->
    <div class="doodle star1">⭐</div>
    <div class="doodle star2">✨</div>
    <div class="doodle heart">💖</div>
    <div class="doodle check">✓</div>
    <div class="doodle flower">🌸</div>

    <div class="container">
        <!-- Header -->
        <header>
            <h1>📚 学習ノート</h1>
            <p class="subtitle">学びたい科目を選んでください</p>
        </header>

        <!-- User Info (Guest Mode) -->
        <div class="user-info">
            <div class="welcome-text">👋 ゲストモードでアクセス中</div>
            <div class="user-actions">
                <a href="learning-notebook/pages/login.html" class="btn btn-primary">ログイン</a>
            </div>
        </div>

        <!-- Continue Learning (Hidden by default) -->
        <div class="continue-section" id="continueSection">
            <div class="continue-title">📖 前回の続きから</div>
            <button class="btn btn-primary" id="continueBtn">続きを学習する</button>
        </div>

        <!-- Subject Cards -->
        <div class="subjects-grid">
            <a href="learning-notebook/pages/english-menu.html" class="subject-card english">
                <span class="subject-icon">📘</span>
                <div class="subject-name">英語</div>
                <div class="subject-desc">語彙・文法・リスニング・読解</div>
            </a>

            <a href="learning-notebook/pages/subject-select.html?subject=math" class="subject-card math">
                <span class="subject-icon">∑</span>
                <div class="subject-name">数学</div>
                <div class="subject-desc">代数・解析・幾何・確率統計</div>
            </a>

            <a href="learning-notebook/pages/subject-select.html?subject=physics" class="subject-card physics">
                <span class="subject-icon">⚛️</span>
                <div class="subject-name">物理</div>
                <div class="subject-desc">力学・電磁気・波動・熱力学</div>
            </a>

            <a href="learning-notebook/pages/subject-select.html?subject=chemistry" class="subject-card chemistry">
                <span class="subject-icon">🧪</span>
                <div class="subject-name">化学</div>
                <div class="subject-desc">理論・無機・有機・実験</div>
            </a>
        </div>
    </div>

    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle" aria-label="テーマ切り替え">
        <span id="themeIcon">🌙</span>
    </button>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const htmlElement = document.documentElement;

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            htmlElement.setAttribute('data-theme', 'dark');
            themeIcon.textContent = '☀️';
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            htmlElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeIcon.textContent = newTheme === 'dark' ? '☀️' : '🌙';
        });

        // Continue Learning Feature
        const continueSection = document.getElementById('continueSection');
        const continueBtn = document.getElementById('continueBtn');

        // Check if there's a last subject
        const lastSubject = localStorage.getItem('lastSubject');
        if (lastSubject) {
            continueSection.classList.add('show');
            continueBtn.addEventListener('click', () => {
                window.location.href = lastSubject;
            });
        }

        // Save last subject on navigation
        document.querySelectorAll('.subject-card').forEach(card => {
            card.addEventListener('click', (e) => {
                localStorage.setItem('lastSubject', card.href);
            });
        });

        // Check for user session
        const userToken = localStorage.getItem('userToken');
        const userName = localStorage.getItem('userName');

        if (userToken && userName) {
            document.querySelector('.user-info').innerHTML = `
                <div class="welcome-text">こんにちは、${userName}さん</div>
                <div class="user-actions">
                    <a href="learning-notebook/pages/profile.html" class="btn">プロフィール</a>
                    <button class="btn" onclick="logout()">ログアウト</button>
                </div>
            `;
        }

        function logout() {
            if (confirm('ログアウトしますか?')) {
                localStorage.removeItem('userToken');
                localStorage.removeItem('userName');
                location.reload();
            }
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Service Worker 登録成功:', registration.scope);

                    // Service Worker の更新チェック
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        console.log('新しい Service Worker が見つかりました');

                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // 新しいバージョンが利用可能
                                if (confirm('新しいバージョンのアプリが利用可能です。更新しますか？')) {
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                }
                            }
                        });
                    });
                })
                .catch(error => {
                    console.error('Service Worker 登録失敗:', error);
                });
        }

        // PWA Install Prompt
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA インストールプロンプト表示可能');
            e.preventDefault();
            deferredPrompt = e;

            // インストールボタンを表示（任意）
            const installBtn = document.createElement('button');
            installBtn.textContent = '📱 アプリをインストール';
            installBtn.className = 'btn btn-primary';
            installBtn.style.position = 'fixed';
            installBtn.style.bottom = '80px';
            installBtn.style.right = '20px';
            installBtn.style.zIndex = '1001';

            installBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('ユーザーが PWA インストールを承諾');
                        } else {
                            console.log('ユーザーが PWA インストールを拒否');
                        }
                        deferredPrompt = null;
                        installBtn.remove();
                    });
                }
            });

            document.body.appendChild(installBtn);
        });

        // PWA インストール完了検知
        window.addEventListener('appinstalled', () => {
            console.log('PWA が正常にインストールされました');
            const installBtn = document.querySelector('[style*="position: fixed"][style*="bottom: 80px"]');
            if (installBtn) {
                installBtn.remove();
            }
        });
    </script>
</body>
</html>
