<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•é¡Œä¸€è¦§ - å•é¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="css/style.css">
    <script src="data/config.js"></script>
    <script src="data/question-types.js"></script>
    <script src="data/sample-data.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="header-title">å•é¡Œä¸€è¦§</h1>
                <div class="header-actions">
                    <button class="btn btn-primary btn-sm" onclick="createNewQuestion()">
                        â• æ–°è¦ä½œæˆ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <nav class="nav">
        <div class="container">
            <a href="index.html" class="nav-item">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <a href="create.html" class="nav-item">â• ä½œæˆ</a>
            <a href="list.html" class="nav-item active">ğŸ“‹ ä¸€è¦§</a>
            <a href="stats.html" class="nav-item">ğŸ“ˆ çµ±è¨ˆ</a>
        </div>
    </nav>

    <main class="container">
        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h2>
            </div>
            <div class="card-body">
                <div class="filter-form">
                    <div class="form-group">
                        <label class="form-label">å•é¡Œã‚¿ã‚¤ãƒ—</label>
                        <select id="filter-type" class="form-select" onchange="applyFilters()">
                            <option value="">ã™ã¹ã¦</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                        <select id="filter-status" class="form-select" onchange="applyFilters()">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="draft">ä¸‹æ›¸ã</option>
                            <option value="published">å…¬é–‹</option>
                            <option value="deleted">å‰Šé™¤æ¸ˆã¿</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é›£æ˜“åº¦</label>
                        <select id="filter-difficulty" class="form-select" onchange="applyFilters()">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="1">åˆç´š</option>
                            <option value="2">ä¸­ç´š</option>
                            <option value="3">ä¸Šç´š</option>
                            <option value="4">æœ€ä¸Šç´š</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ã‚¿ã‚°</label>
                        <input type="text" id="filter-tags" class="form-input" placeholder="ã‚¿ã‚°ã§æ¤œç´¢" onkeyup="applyFilters()">
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸¦ã³æ›¿ãˆ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ä¸¦ã³æ›¿ãˆ</h2>
            </div>
            <div class="card-body">
                <div class="sort-form">
                    <select id="sort-by" class="form-select" onchange="applyFilters()">
                        <option value="created">ä½œæˆæ—¥æ™‚</option>
                        <option value="modified">æ›´æ–°æ—¥æ™‚</option>
                        <option value="difficulty">é›£æ˜“åº¦</option>
                        <option value="type">å•é¡Œã‚¿ã‚¤ãƒ—</option>
                    </select>
                    <select id="sort-order" class="form-select" onchange="applyFilters()">
                        <option value="desc">é™é †</option>
                        <option value="asc">æ˜‡é †</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- å•é¡Œä¸€è¦§ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">å•é¡Œä¸€è¦§</h2>
                <span id="question-count">0 ä»¶</span>
            </div>
            <div class="card-body">
                <div id="questions-list">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div id="pagination" class="pagination">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </main>

    <script src="js/app.js"></script>
    <script>
        // ãƒšãƒ¼ã‚¸å¤‰æ•°
        let currentPage = 1;
        let filteredQuestions = [];
        let questionsPerPage = 10;

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // å•é¡Œã‚¿ã‚¤ãƒ—é¸æŠè‚¢ã‚’ç”Ÿæˆ
            const typeSelect = document.getElementById('filter-type');
            Object.keys(window.QUESTION_TYPES).forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = window.QUESTION_TYPES[type].name;
                typeSelect.appendChild(option);
            });

            // åˆå›ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            setTimeout(() => {
                applyFilters();
            }, 1000);
        }

        function applyFilters() {
            if (!window.app) return;

            const type = document.getElementById('filter-type').value;
            const status = document.getElementById('filter-status').value;
            const difficulty = document.getElementById('filter-difficulty').value;
            const tags = document.getElementById('filter-tags').value;
            const sortBy = document.getElementById('sort-by').value;
            const sortOrder = document.getElementById('sort-order').value;

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
            filteredQuestions = [];
            
            Object.keys(window.app.questions).forEach(questionType => {
                const questions = window.app.getQuestions(questionType, {
                    status: status,
                    difficulty: difficulty ? parseInt(difficulty) : null,
                    tags: tags ? tags.split(',').map(t => t.trim()) : null,
                    sortBy: sortBy
                });

                // å•é¡Œã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (!type || type === questionType) {
                    filteredQuestions.push(...questions.map(q => ({...q, type: questionType})));
                }
            });

            // ã‚½ãƒ¼ãƒˆé †ã®èª¿æ•´
            if (sortOrder === 'asc') {
                filteredQuestions.reverse();
            }

            currentPage = 1;
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('questions-list');
            const countElement = document.getElementById('question-count');
            
            countElement.textContent = `${filteredQuestions.length} ä»¶`;

            if (filteredQuestions.length === 0) {
                container.innerHTML = '<p class="text-muted">å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“</p>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
            const totalPages = Math.ceil(filteredQuestions.length / questionsPerPage);
            const startIndex = (currentPage - 1) * questionsPerPage;
            const endIndex = startIndex + questionsPerPage;
            const pageQuestions = filteredQuestions.slice(startIndex, endIndex);

            // å•é¡Œãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
            let html = '';
            pageQuestions.forEach(question => {
                html += createQuestionItem(question);
            });

            container.innerHTML = html;

            // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
            renderPagination(totalPages);
        }

        function createQuestionItem(question) {
            const questionType = window.QUESTION_TYPES[question.type];
            const statusClass = question.status === 'published' ? 'badge-success' : 
                               question.status === 'draft' ? 'badge-secondary' : 'badge-error';
            
            const statusText = question.status === 'published' ? 'å…¬é–‹' : 
                             question.status === 'draft' ? 'ä¸‹æ›¸ã' : 'å‰Šé™¤æ¸ˆã¿';

            return `
                <div class="list-item">
                    <div class="question-info">
                        <div class="question-header">
                            <h3>${getQuestionTitle(question)}</h3>
                            <div class="question-meta">
                                <span class="badge ${statusClass}">${statusText}</span>
                                <span class="badge badge-secondary">${window.CONFIG.DIFFICULTY_LEVELS[question.difficulty]}</span>
                                <span class="badge badge-secondary">${questionType.name}</span>
                            </div>
                        </div>
                        <div class="question-details">
                            <p><strong>ä½œæˆæ—¥:</strong> ${new Date(question.created).toLocaleDateString('ja-JP')}</p>
                            ${question.modified ? `<p><strong>æ›´æ–°æ—¥:</strong> ${new Date(question.modified).toLocaleDateString('ja-JP')}</p>` : ''}
                            ${question.tags && question.tags.length > 0 ? `<p><strong>ã‚¿ã‚°:</strong> ${question.tags.map(tag => `<span class="badge badge-secondary">${tag}</span>`).join(' ')}</p>` : ''}
                        </div>
                    </div>
                    <div class="question-actions">
                        <button class="btn btn-primary btn-sm" onclick="editQuestion('${question.type}', '${question.id}')">
                            âœï¸ ç·¨é›†
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewQuestion('${question.type}', '${question.id}')">
                            ğŸ‘ï¸ è¡¨ç¤º
                        </button>
                        ${question.status === 'draft' ? 
                            `<button class="btn btn-success btn-sm" onclick="publishQuestion('${question.type}', '${question.id}')">
                                ğŸ“¢ å…¬é–‹
                            </button>` : 
                            `<button class="btn btn-warning btn-sm" onclick="unpublishQuestion('${question.type}', '${question.id}')">
                                ğŸ”„ éå…¬é–‹
                            </button>`
                        }
                        <button class="btn btn-error btn-sm" onclick="deleteQuestion('${question.type}', '${question.id}')">
                            ğŸ—‘ï¸ å‰Šé™¤
                        </button>
                    </div>
                </div>
            `;
        }

        function getQuestionTitle(question) {
            switch (question.type) {
                case 'vocab_meaning':
                    return question.word || 'ç„¡é¡Œ';
                case 'vocab_fill':
                    return question.sentence || 'ç„¡é¡Œ';
                case 'grammar_underline':
                    return question.sentence || 'ç„¡é¡Œ';
                case 'grammar_reorder':
                    return 'èªé †ä¸¦ã¹æ›¿ãˆå•é¡Œ';
                case 'reading_comprehension':
                    return 'èª­è§£å•é¡Œ';
                case 'listening_comprehension':
                    return 'ãƒªã‚¹ãƒ‹ãƒ³ã‚°å•é¡Œ';
                case 'summary_short':
                case 'summary_medium':
                case 'summary_long':
                    return 'è¦ç´„å•é¡Œ';
                default:
                    return 'ç„¡é¡Œ';
            }
        }

        function renderPagination(totalPages) {
            const container = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '<div class="pagination-controls">';
            
            // å‰ã®ãƒšãƒ¼ã‚¸
            if (currentPage > 1) {
                html += `<button class="btn btn-secondary btn-sm" onclick="goToPage(${currentPage - 1})">â† å‰</button>`;
            }
            
            // ãƒšãƒ¼ã‚¸ç•ªå·
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="btn btn-primary btn-sm">${i}</button>`;
                } else {
                    html += `<button class="btn btn-secondary btn-sm" onclick="goToPage(${i})">${i}</button>`;
                }
            }
            
            // æ¬¡ã®ãƒšãƒ¼ã‚¸
            if (currentPage < totalPages) {
                html += `<button class="btn btn-secondary btn-sm" onclick="goToPage(${currentPage + 1})">æ¬¡ â†’</button>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function goToPage(page) {
            currentPage = page;
            renderQuestions();
        }

        function createNewQuestion() {
            window.location.href = 'create.html';
        }

        function editQuestion(type, id) {
            window.location.href = `edit.html?type=${type}&id=${id}`;
        }

        function viewQuestion(type, id) {
            const question = window.app.getQuestion(type, id);
            if (question) {
                alert('å•é¡Œè©³ç´°:\n\n' + JSON.stringify(question, null, 2));
            }
        }

        function publishQuestion(type, id) {
            if (confirm('ã“ã®å•é¡Œã‚’å…¬é–‹ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    window.app.publishQuestion(type, id);
                    window.app.showNotification('å•é¡Œã‚’å…¬é–‹ã—ã¾ã—ãŸ', 'success');
                    applyFilters();
                } catch (error) {
                    window.app.showNotification('å…¬é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }

        function unpublishQuestion(type, id) {
            if (confirm('ã“ã®å•é¡Œã‚’éå…¬é–‹ã«ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    window.app.unpublishQuestion(type, id);
                    window.app.showNotification('å•é¡Œã‚’éå…¬é–‹ã«ã—ã¾ã—ãŸ', 'success');
                    applyFilters();
                } catch (error) {
                    window.app.showNotification('éå…¬é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }

        function deleteQuestion(type, id) {
            if (confirm('ã“ã®å•é¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    window.app.deleteQuestion(type, id);
                    window.app.showNotification('å•é¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                    applyFilters();
                } catch (error) {
                    window.app.showNotification('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }
    </script>
</body>
</html>