# Cloudflare Worker Configuration for Search API
name = "data-manager-search"
main = "search-worker.js"
compatibility_date = "2024-01-01"

# Environment variables
[env.production.vars]
ENVIRONMENT = "production"
API_VERSION = "1.0.0"

[env.staging.vars]
ENVIRONMENT = "staging"
API_VERSION = "1.0.0"

# D1 Database binding
[[env.production.d1_databases]]
binding = "DB"
database_name = "data-manager-prod"
database_id = "your-production-database-id"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "data-manager-staging"
database_id = "your-staging-database-id"

# R2 bucket binding (for media files)
[[env.production.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "data-manager-media-prod"

[[env.staging.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "data-manager-media-staging"

# KV namespace binding (for caching)
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "your-production-kv-id"

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "your-staging-kv-id"

# Cron triggers for maintenance
[[env.production.triggers]]
cron = "0 2 * * *"  # Daily at 2 AM

# Custom domains
[env.production]
routes = [
  { pattern = "api.data.allfrom0.top/*", custom_domain = true }
]

[env.staging]
routes = [
  { pattern = "api-staging.data.allfrom0.top/*", custom_domain = true }
]