<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•é¡Œç®¡ç†ä½œæˆã‚·ã‚¹ãƒ†ãƒ </title>
    <meta name="description" content="ãƒ¢ãƒã‚¤ãƒ«å‘ã‘å•é¡Œç®¡ç†ä½œæˆã‚·ã‚¹ãƒ†ãƒ ">
    <meta name="theme-color" content="#10b981">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å•é¡Œç®¡ç†">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="data/config.js"></script>
    <script src="data/question-types.js"></script>
    <script src="data/sample-data.js"></script>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="header-title">å•é¡Œç®¡ç†</h1>
                <div class="header-actions">
                    <button class="btn btn-icon" onclick="toggleTheme()" title="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">
                        <span id="theme-icon">ğŸŒ</span>
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="exportData()">
                        ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="nav">
        <div class="container">
            <a href="index.html" class="nav-item active">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <a href="create.html" class="nav-item">â• ä½œæˆ</a>
            <a href="list.html" class="nav-item">ğŸ“‹ ä¸€è¦§</a>
            <a href="stats.html" class="nav-item">ğŸ“ˆ çµ±è¨ˆ</a>
        </div>
    </nav>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="container">
        <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-questions">0</div>
                <div class="stat-label">ç·å•é¡Œæ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="published-questions">0</div>
                <div class="stat-label">å…¬é–‹æ¸ˆã¿</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="draft-questions">0</div>
                <div class="stat-label">ä¸‹æ›¸ã</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="recent-activity">0</div>
                <div class="stat-label">æœ€è¿‘ã®æ´»å‹•</div>
            </div>
        </section>

        <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="card">
            <div class="card-header">
                <h2 class="card-title">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
            </div>
            <div class="card-body">
                <div class="quick-actions">
                    <button class="btn btn-primary btn-block" onclick="createNewQuestion()">
                        â• æ–°ã—ã„å•é¡Œã‚’ä½œæˆ
                    </button>
                    <button class="btn btn-secondary btn-block" onclick="loadSampleData()">
                        ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                    </button>
                    <button class="btn btn-secondary btn-block" onclick="showAllQuestions()">
                        ğŸ“‹ ã™ã¹ã¦ã®å•é¡Œã‚’è¡¨ç¤º
                    </button>
                </div>
            </div>
        </section>

        <!-- å•é¡Œã‚¿ã‚¤ãƒ—åˆ¥ã®æ¦‚è¦ -->
        <section class="card">
            <div class="card-header">
                <h2 class="card-title">å•é¡Œã‚¿ã‚¤ãƒ—åˆ¥æ¦‚è¦</h2>
            </div>
            <div class="card-body">
                <div id="question-types-overview">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- æœ€è¿‘ã®æ´»å‹• -->
        <section class="card">
            <div class="card-header">
                <h2 class="card-title">æœ€è¿‘ã®æ´»å‹•</h2>
            </div>
            <div class="card-body">
                <div id="recent-activity-list">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- ã‚ˆãä½¿ã†ã‚¿ã‚° -->
        <section class="card">
            <div class="card-header">
                <h2 class="card-title">ã‚ˆãä½¿ã†ã‚¿ã‚°</h2>
            </div>
            <div class="card-body">
                <div id="popular-tags">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </section>
    </main>

    <!-- JavaScript -->
    <script src="js/app.js"></script>
    
    <script>
        // ãƒšãƒ¼ã‚¸å›ºæœ‰ã®æ©Ÿèƒ½
        function updateDashboard() {
            if (!window.app) return;
            
            const stats = window.app.statistics;
            
            // çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã®æ›´æ–°
            document.getElementById('total-questions').textContent = stats.totalQuestions || 0;
            document.getElementById('published-questions').textContent = stats.questionsByStatus.published || 0;
            document.getElementById('draft-questions').textContent = stats.questionsByStatus.draft || 0;
            document.getElementById('recent-activity').textContent = stats.recentActivity.length || 0;
            
            // å•é¡Œã‚¿ã‚¤ãƒ—åˆ¥æ¦‚è¦ã®æ›´æ–°
            updateQuestionTypesOverview();
            
            // æœ€è¿‘ã®æ´»å‹•ã®æ›´æ–°
            updateRecentActivity();
            
            // ã‚ˆãä½¿ã†ã‚¿ã‚°ã®æ›´æ–°
            updatePopularTags();
        }

        function updateQuestionTypesOverview() {
            const container = document.getElementById('question-types-overview');
            const stats = window.app.statistics.questionsByType;
            
            let html = '';
            Object.keys(stats).forEach(type => {
                const count = stats[type];
                const typeInfo = window.getQuestionType(type);
                if (typeInfo) {
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>${typeInfo.name}</strong>
                                <div class="text-muted">${count} å•</div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="createQuestionByType('${type}')">
                                ä½œæˆ
                            </button>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html || '<p class="text-muted">å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“</p>';
        }

        function updateRecentActivity() {
            const container = document.getElementById('recent-activity-list');
            const activities = window.app.statistics.recentActivity || [];
            
            let html = '';
            activities.slice(0, 5).forEach(activity => {
                const date = new Date(activity.timestamp);
                const dateStr = date.toLocaleDateString('ja-JP');
                const timeStr = date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                
                const actionLabels = {
                    create: 'ä½œæˆ',
                    update: 'æ›´æ–°',
                    delete: 'å‰Šé™¤',
                    publish: 'å…¬é–‹'
                };
                
                html += `
                    <div class="list-item">
                        <div>
                            <div class="text-primary">${actionLabels[activity.action] || activity.action}</div>
                            <div class="text-muted">${activity.type} - ${dateStr} ${timeStr}</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || '<p class="text-muted">æœ€è¿‘ã®æ´»å‹•ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        }

        function updatePopularTags() {
            const container = document.getElementById('popular-tags');
            const allTags = {};
            
            // å…¨ã¦ã®ã‚¿ã‚°ã‚’åé›†
            Object.keys(window.app.questions).forEach(type => {
                window.app.questions[type].forEach(question => {
                    if (question.tags) {
                        question.tags.forEach(tag => {
                            allTags[tag] = (allTags[tag] || 0) + 1;
                        });
                    }
                });
            });
            
            // ä½¿ç”¨é »åº¦ã§ã‚½ãƒ¼ãƒˆ
            const sortedTags = Object.entries(allTags)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            let html = '<div class="tags-container">';
            sortedTags.forEach(([tag, count]) => {
                html += `<span class="badge badge-secondary" style="margin: 2px;">${tag} (${count})</span>`;
            });
            html += '</div>';
            
            container.innerHTML = html || '<p class="text-muted">ã‚¿ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        }

        function createNewQuestion() {
            window.location.href = 'create.html';
        }

        function createQuestionByType(type) {
            window.location.href = `create.html?type=${type}`;
        }

        function showAllQuestions() {
            window.location.href = 'list.html';
        }

        function exportData() {
            if (!window.app) return;
            
            try {
                const data = window.app.exportData('json');
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `questions_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                window.app.showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                window.app.showNotification('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                icon.textContent = 'ğŸŒ';
                localStorage.setItem(window.CONFIG.STORAGE_PREFIX + 'theme', 'light');
            } else {
                body.classList.add('dark-theme');
                icon.textContent = 'ğŸŒ™';
                localStorage.setItem(window.CONFIG.STORAGE_PREFIX + 'theme', 'dark');
            }
        }

        // ã‚¢ãƒ—ãƒªãŒåˆæœŸåŒ–ã•ã‚ŒãŸã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ›´æ–°
        document.addEventListener('DOMContentLoaded', function() {
            // å®šæœŸçš„ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ›´æ–°
            setInterval(() => {
                if (window.app) {
                    updateDashboard();
                }
            }, 5000);
            
            // åˆå›æ›´æ–°
            setTimeout(() => {
                updateDashboard();
            }, 1000);
        });
    </script>
</body>
</html>