<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fef5e7">
    <title>ぜろ - 科目選択</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">

    <!-- Theme Color -->
    <meta name="theme-color" content="#4285f4">

    <!-- Apple Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ぜろ">

    <link rel="icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Zen+Kurenaido&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theme-toggle.css">
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0">
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <script src="../js/theme.js"></script>
    <script src="../js/core/unified-api-client.js"></script>
    <script src="../js/core/auth-manager.js"></script>
    <script src="../js/components/sidebar.js"></script>
</head>

<body>
    <div class="notebook">
        <div class="doodle-bg doodle-star">★</div>
        <div class="doodle-bg doodle-heart">♡</div>
        <div class="doodle-bg doodle-note">♪</div>
        <div class="doodle-bg doodle-smile">☺</div>
        <div class="doodle-bg doodle-check">✓</div>
        <div class="doodle-bg doodle-arrow">→</div>
        <div class="doodle-bg doodle-circle">◯</div>
        <div class="doodle-bg doodle-flower">✿</div>
        <div class="doodle-bg doodle-sun">☀</div>
        <div class="doodle-bg doodle-cloud">☁</div>
        <div class="doodle-bg doodle-pencil">✏</div>
        <div class="doodle-bg doodle-book"><span class="material-symbols-outlined icon">menu_book</span></div>

        <div class="scribble scribble-1"></div>
        <div class="scribble scribble-2"></div>
        <div class="scribble scribble-3"></div>

        <div class="container">
            <div class="main-content">
                <div class="subject-select">
                    <h1>学習ノート</h1>
                    <p class="subtitle">科目を選んでください</p>

                    <div class="user-info">
                        <p class="welcome-text">こんにちは、<span id="userName">ゲスト</span>さん</p>
                        <div class="user-actions">
                            <button class="profile-btn" onclick="location.href='profile.html'">プロフィール</button>
                            <button class="logout-btn" onclick="logout()">ログアウト</button>
                        </div>
                    </div>

                    <div id="continueSection" class="continue-section hidden">
                        <button class="continue-btn" onclick="continueLastStudy()">
                            <span class="continue-icon">▶</span>
                            <div class="continue-text">
                                <div class="continue-title">前回の続きから</div>
                                <div class="continue-detail" id="continueDetail">-</div>
                            </div>
                        </button>
                    </div>

                    <div class="subject-grid">
                        <div class="subject-card" onclick="location.href='english-menu.html'">
                            <div class="subject-icon">
                                <img src="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/5910d357-feb5-4753-9498-5833ec63668d.svg" alt="英語" class="icon-large" style="width: 48px; height: 48px;">
                            </div>
                            <div class="subject-name">英語</div>
                        </div>
                        <div class="subject-card" onclick="location.href='category-detail.html?category=math'">
                            <div class="subject-icon">
                                <img src="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/Generated%20Image%20November%2020%2C%202025%20-%2010_26PM.svg" alt="数学" class="icon-large" style="width: 48px; height: 48px; object-fit: contain;">
                            </div>
                            <div class="subject-name">数学</div>
                        </div>
                        <div class="subject-card" onclick="location.href='category-detail.html?category=physics'">
                            <div class="subject-icon">
                                <img src="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/59da51bc-90c4-4bcc-992e-902a8cea7c01.svg" alt="物理" class="icon-large" style="width: 56px; height: 56px; object-fit: contain;">
                            </div>
                            <div class="subject-name">物理</div>
                        </div>
                        <div class="subject-card" onclick="location.href='category-detail.html?category=chemistry'">
                            <div class="subject-icon">
                                <img src="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/continuous-line-beaker-drawing-laboratory-600nw-2428073369.svg" alt="化学" class="icon-large" style="width: 56px; height: 56px; object-fit: contain;">
                            </div>
                            <div class="subject-name">化学</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右サイドバー（統一コンポーネントにより自動生成） -->
            <div class="right-sidebar">
            </div>
        </div>
    </div>

    <script>
        let lastStudy = null;

        document.addEventListener('DOMContentLoaded', async () => {
            if (window.authReady) {
                await window.authReady;
            }

            const currentUser = typeof window.getCurrentUser === 'function'
                ? window.getCurrentUser()
                : null;

            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userName').textContent = currentUser.displayName || currentUser.username;

            const lastStudyKey = currentUser.isGuest
                ? 'lastStudy_guest'
                : `lastStudy_${currentUser.username || currentUser.userId}`;

            lastStudy = JSON.parse(localStorage.getItem(lastStudyKey));

            if (lastStudy && lastStudy.subject && lastStudy.level) {
                const continueSection = document.getElementById('continueSection');
                const continueDetail = document.getElementById('continueDetail');

                const levelNames = {
                    'vocab_1': '1級',
                    'vocab_pre1': '準1級',
                    'vocab_2': '2級',
                    'vocab_other': '基礎',
                    'listen_kyotsu': '共通テスト',
                    'listen_todai': '東大',
                    'listen_other': '基礎',
                    'grammar_4choice': '四択問題',
                    'grammar_correct': '誤文訂正',
                    'grammar_fill': '空所補充',
                    'grammar_arrange': '整序問題',
                    'read_1b': '1B',
                    'read_5': '5',
                    'math_1a': '1A',
                    'math_2b': '2B',
                    'math_3c': '3C',
                    'math_random': 'ランダム演習',
                    'physics_mechanics': '力学',
                    'physics_electric': '電磁気',
                    'physics_wave': '波動',
                    'physics_thermo': '熱',
                    'physics_atomic': '原子',
                    'chem_theory': '理論',
                    'chem_inorganic': '無機',
                    'chem_organic': '有機'
                };

                const subjectNames = {
                    'vocabulary': '英語 - 語彙',
                    'listening': '英語 - リスニング',
                    'grammar': '英語 - 文法',
                    'reading': '英語 - 読解',
                    'math': '数学',
                    'physics': '物理',
                    'chemistry': '化学'
                };

                const levelName = levelNames[lastStudy.level] || lastStudy.level;
                const subjectName = subjectNames[lastStudy.subject] || lastStudy.subject;

                continueDetail.textContent = `${subjectName} - ${levelName}`;
                continueSection.classList.remove('hidden');
            }
        });

        function continueLastStudy() {
            if (lastStudy && lastStudy.subject && lastStudy.level) {
                window.location.href = `study.html?subject=${lastStudy.subject}&level=${lastStudy.level}`;
            }
        }

        async function logout() {
            if (!confirm('ログアウトしますか？')) return;

            if (typeof window.performLogout === 'function') {
                await window.performLogout();
            }
            window.location.href = 'login.html';
        }
    </script>

<!-- Service Worker disabled to prevent cache conflicts -->
<script>
    console.log("Service Worker and PWA features disabled for stability");
</script>

<script src="../js/features/sidebar-toggle.js"></script>
</body>

</html>
