<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fef5e7">
    <title>ぜろ - 科目選択</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">

    <!-- Theme Color -->
    <meta name="theme-color" content="#4285f4">

    <!-- Apple Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ぜろ">

    <link rel="icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Zen+Kurenaido&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theme-toggle.css">
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0">
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <script src="../js/theme.js"></script>
    <script src="../js/core/unified-api-client.js"></script>
    <script src="../js/core/auth-manager.js"></script>
</head>

<body>
    <div class="notebook">
        <div class="doodle-bg doodle-star">★</div>
        <div class="doodle-bg doodle-heart">♡</div>
        <div class="doodle-bg doodle-note">♪</div>
        <div class="doodle-bg doodle-smile">☺</div>
        <div class="doodle-bg doodle-check">✓</div>
        <div class="doodle-bg doodle-arrow">→</div>
        <div class="doodle-bg doodle-circle">◯</div>
        <div class="doodle-bg doodle-flower">✿</div>
        <div class="doodle-bg doodle-sun">☀</div>
        <div class="doodle-bg doodle-cloud">☁</div>
        <div class="doodle-bg doodle-pencil">✏</div>
        <div class="doodle-bg doodle-book"><span class="material-symbols-outlined icon">menu_book</span></div>

        <div class="scribble scribble-1"></div>
        <div class="scribble scribble-2"></div>
        <div class="scribble scribble-3"></div>

        <div class="container">
            <div class="main-content">
                <div class="subject-select">
                    <h1>学習ノート</h1>
                    <p class="subtitle">科目を選んでください</p>

                    <div class="user-info">
                        <p class="welcome-text">こんにちは、<span id="userName">ゲスト</span>さん</p>
                        <div class="user-actions">
                            <button class="profile-btn" onclick="location.href='profile.html'">プロフィール</button>
                            <button class="logout-btn" onclick="logout()">ログアウト</button>
                        </div>
                    </div>

                    <div id="continueSection" class="continue-section hidden">
                        <button class="continue-btn" onclick="continueLastStudy()">
                            <span class="continue-icon">▶</span>
                            <div class="continue-text">
                                <div class="continue-title">前回の続きから</div>
                                <div class="continue-detail" id="continueDetail">-</div>
                            </div>
                        </button>
                    </div>

                    <div class="subject-grid">
                        <div class="subject-card" onclick="location.href='english-menu.html'">
                            <div class="subject-icon">
                                <span class="material-symbols-rounded icon-large">language</span>
                            </div>
                            <div class="subject-name">英語</div>
                        </div>
                        <div class="subject-card" onclick="location.href='category-detail.html?category=math'">
                            <div class="subject-icon">
                                <span class="material-symbols-outlined icon-large">functions</span>
                            </div>
                            <div class="subject-name">数学</div>
                        </div>
                        <div class="subject-card" onclick="location.href='category-detail.html?category=physics'">
                            <div class="subject-icon">
                                <span class="material-symbols-outlined icon-large">bolt</span>
                            </div>
                            <div class="subject-name">物理</div>
                        </div>
                        <div class="subject-card" onclick="location.href='category-detail.html?category=chemistry'">
                            <div class="subject-icon">
                                <span class="material-symbols-outlined icon-large">science</span>
                            </div>
                            <div class="subject-name">化学</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右サイドバー -->
            <div class="right-sidebar">
                <!-- 進捗状況カード -->
                <div class="sidebar-card">
                    <span class="sidebar-doodle sidebar-doodle-1">
                        <span class="material-symbols-rounded icon">trending_up</span>
                    </span>
                    <span class="sidebar-doodle sidebar-doodle-2">
                        <span class="material-symbols-rounded icon">auto_awesome</span>
                    </span>
                    <h3 class="sidebar-title">学習進捗</h3>
                    <div class="sidebar-content">
                        <div class="sidebar-streak">
                            <span class="sidebar-streak-number">7</span>日連続！
                        </div>
                        <div class="sidebar-progress">
                            <div>今日の目標: 80%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                        </div>
                        <div class="sidebar-progress">
                            <div>今週の進捗: 12/15</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 80%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- クイックナビゲーションカード -->
                <div class="sidebar-card">
                    <span class="sidebar-doodle sidebar-doodle-1">
                        <span class="material-symbols-rounded icon">rocket_launch</span>
                    </span>
                    <span class="sidebar-doodle sidebar-doodle-2">
                        <span class="material-symbols-outlined icon">edit_note</span>
                    </span>
                    <h3 class="sidebar-title">クイックメニュー</h3>
                    <div class="sidebar-content">
                        <ul class="sidebar-list">
                            <li><a href="subject-select.html" class="sidebar-link">
                                <span class="material-symbols-outlined icon icon-small">menu_book</span> 科目選択
                            </a></li>
                            <li><a href="profile.html" class="sidebar-link">
                                <span class="material-symbols-outlined icon icon-small">person</span> プロフィール
                            </a></li>
                            <li><a href="review.html" class="sidebar-link">
                                <span class="material-symbols-outlined icon icon-small">replay</span> 復習モード
                            </a></li>
                            <li><a href="mana/index.html" class="sidebar-link">
                                <span class="material-symbols-outlined icon icon-small">edit</span> Mana管理
                            </a></li>
                        </ul>
                    </div>
                </div>

                <!-- おすすめ学習カード -->
                <div class="sidebar-card">
                    <span class="sidebar-doodle sidebar-doodle-1">
                        <span class="material-symbols-rounded icon">lightbulb</span>
                    </span>
                    <span class="sidebar-doodle sidebar-doodle-2">
                        <span class="material-symbols-outlined icon">track_changes</span>
                    </span>
                    <h3 class="sidebar-title">今日のおすすめ</h3>
                    <div class="sidebar-content">
                        <div style="margin-bottom: 10px;">
                            <strong>英単語：重要動詞</strong><br>
                            <small style="color: var(--text-secondary);">前回学習から3日経過</small>
                        </div>
                        <a href="study.html?subject=english-vocabulary&category=important-verbs" class="sidebar-nav-btn">
                            続きから学習する
                        </a>
                    </div>
                </div>

                <!-- 統計情報カード -->
                <div class="sidebar-card">
                    <span class="sidebar-doodle sidebar-doodle-1">
                        <span class="material-symbols-outlined icon">bar_chart</span>
                    </span>
                    <span class="sidebar-doodle sidebar-doodle-2">
                        <span class="material-symbols-rounded icon">stars</span>
                    </span>
                    <h3 class="sidebar-title">学習統計</h3>
                    <div class="sidebar-content">
                        <ul class="sidebar-list">
                            <li>総学習時間: 124時間</li>
                            <li>解決問題数: 1,847問</li>
                            <li>正解率: 78.3%</li>
                            <li>得意科目: 英文法</li>
                        </ul>
                    </div>
                </div>

                <!-- 設定カード -->
                <div class="sidebar-card">
                    <span class="sidebar-doodle sidebar-doodle-1">
                        <span class="material-symbols-outlined icon">settings</span>
                    </span>
                    <span class="sidebar-doodle sidebar-doodle-2">
                        <span class="material-symbols-outlined icon">dark_mode</span>
                    </span>
                    <h3 class="sidebar-title">設定</h3>
                    <div class="sidebar-content">
                        <a href="#" class="sidebar-nav-btn" onclick="toggleTheme(); return false;">
                            <span class="material-symbols-outlined icon icon-small">contrast</span>
                            <span>テーマ切替</span>
                        </a>
                        <a href="recovery-contact.html" class="sidebar-nav-btn">
                            <span class="material-symbols-outlined icon icon-small">contact_support</span>
                            <span>お問い合わせ</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let lastStudy = null;

        document.addEventListener('DOMContentLoaded', async () => {
            if (window.authReady) {
                await window.authReady;
            }

            const currentUser = typeof window.getCurrentUser === 'function'
                ? window.getCurrentUser()
                : null;

            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userName').textContent = currentUser.displayName || currentUser.username;

            const lastStudyKey = currentUser.isGuest
                ? 'lastStudy_guest'
                : `lastStudy_${currentUser.username || currentUser.userId}`;

            lastStudy = JSON.parse(localStorage.getItem(lastStudyKey));

            if (lastStudy && lastStudy.subject && lastStudy.level) {
                const continueSection = document.getElementById('continueSection');
                const continueDetail = document.getElementById('continueDetail');

                const levelNames = {
                    'vocab_1': '1級',
                    'vocab_pre1': '準1級',
                    'vocab_2': '2級',
                    'vocab_other': '基礎',
                    'listen_kyotsu': '共通テスト',
                    'listen_todai': '東大',
                    'listen_other': '基礎',
                    'grammar_4choice': '四択問題',
                    'grammar_correct': '誤文訂正',
                    'grammar_fill': '空所補充',
                    'grammar_arrange': '整序問題',
                    'read_1b': '1B',
                    'read_5': '5',
                    'math_1a': '1A',
                    'math_2b': '2B',
                    'math_3c': '3C',
                    'math_random': 'ランダム演習',
                    'physics_mechanics': '力学',
                    'physics_electric': '電磁気',
                    'physics_wave': '波動',
                    'physics_thermo': '熱',
                    'physics_atomic': '原子',
                    'chem_theory': '理論',
                    'chem_inorganic': '無機',
                    'chem_organic': '有機'
                };

                const subjectNames = {
                    'vocabulary': '英語 - 語彙',
                    'listening': '英語 - リスニング',
                    'grammar': '英語 - 文法',
                    'reading': '英語 - 読解',
                    'math': '数学',
                    'physics': '物理',
                    'chemistry': '化学'
                };

                const levelName = levelNames[lastStudy.level] || lastStudy.level;
                const subjectName = subjectNames[lastStudy.subject] || lastStudy.subject;

                continueDetail.textContent = `${subjectName} - ${levelName}`;
                continueSection.classList.remove('hidden');
            }
        });

        function continueLastStudy() {
            if (lastStudy && lastStudy.subject && lastStudy.level) {
                window.location.href = `study.html?subject=${lastStudy.subject}&level=${lastStudy.level}`;
            }
        }

        async function logout() {
            if (!confirm('ログアウトしますか？')) return;

            if (typeof window.performLogout === 'function') {
                await window.performLogout();
            }
            window.location.href = 'login.html';
        }
    </script>

<!-- Service Worker disabled to prevent cache conflicts -->
<script>
    console.log("Service Worker and PWA features disabled for stability");
</script>

<script src="../js/features/sidebar-toggle.js"></script>
</body>

</html>
