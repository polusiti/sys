<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªè¨¼ãƒ†ã‚¹ãƒˆ - å•é¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="common.css">
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ”§ èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h1>
    <div id="testResults"></div>
    
    <script src="auth-simple.js"></script>
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('testResults').appendChild(div);
        }
        
        // ãƒ†ã‚¹ãƒˆ1: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨å¯èƒ½ã‹
        addResult('ãƒ†ã‚¹ãƒˆ1: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ç¢ºèª...', 'info');
        if (window.auth || window.AuthenticationSystem) {
            addResult('âœ… èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');
        } else {
            addResult('âŒ èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
        }
        
        // ãƒ†ã‚¹ãƒˆ2: ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ
        addResult('ãƒ†ã‚¹ãƒˆ2: ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã®ç¢ºèª...', 'info');
        try {
            if (window.auth) {
                window.auth.enableDemoMode();
                const user = window.auth.getCurrentUser();
                if (user && user.role === 'admin') {
                    addResult('âœ… ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã§ã™', 'success');
                } else {
                    addResult('âŒ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } else if (window.AuthenticationSystem) {
                window.AuthenticationSystem.enableDemoMode();
                const user = window.AuthenticationSystem.getCurrentUser();
                if (user && user.role === 'admin') {
                    addResult('âœ… ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã§ã™', 'success');
                } else {
                    addResult('âŒ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        } catch (e) {
            addResult(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}`, 'error');
        }
        
        // ãƒ†ã‚¹ãƒˆ3: æ¨©é™ãƒã‚§ãƒƒã‚¯
        addResult('ãƒ†ã‚¹ãƒˆ3: æ¨©é™ãƒã‚§ãƒƒã‚¯...', 'info');
        const currentUser = window.auth?.getCurrentUser() || window.AuthenticationSystem?.getCurrentUser();
        if (currentUser && currentUser.permissions) {
            addResult(`âœ… ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${currentUser.displayName} (${currentUser.role})`, 'success');
            addResult(`æ¨©é™: ${currentUser.permissions.join(', ')}`, 'info');
        } else {
            addResult('âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“', 'error');
        }
        
        // ãƒ†ã‚¹ãƒˆ4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
        addResult('ãƒ†ã‚¹ãƒˆ4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š...', 'info');
        const script = document.createElement('script');
        script.src = 'database-fixed.js';
        script.onload = () => {
            if (window.Database) {
                addResult('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');
            } else {
                addResult('âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        };
        script.onerror = () => {
            addResult('âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        };
        document.head.appendChild(script);
        
        addResult('\nğŸ“ ãƒ†ã‚¹ãƒˆå®Œäº†ï¼å„ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æ©Ÿèƒ½ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'info');
    </script>
</body>
</html>